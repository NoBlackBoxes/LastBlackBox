<!DOCTYPE html>

<head>
    {% include 'pwa.html' %}
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='styles/lesson.css')}}" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins">
</head>

<html>

<body>
    <title>LBB : {{course.name}}</title>
    <div id="layout_div" style="background-image: url({{url_for('static', filename='images/layout/layout.svg')}});"></div>
    <div id="content_div">
        <div id="heading_div">
            <span id="course_heading">{{course.name}} : {{session.name}} : {{box.name}}</span>
            <span id="lesson_heading">{{lesson.name}}</span>
        </div>
        <span id="lesson_description">{{ lesson.description | safe }}</span>
        <span id="watch_video_label">Watch this video</span>
        <iframe id="video_player" src="https://player.vimeo.com/video/{{lesson.video.id}}?badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479" width="640" height="360" frameborder="0" allow="autoplay; fullscreen; picture-in-picture; clipboard-write" title={{lesson.video.name}}></iframe>
        <div id="steps_div">
            {% for step in lesson.steps %}
            {% if step.type == "task" %}
            <div class="task_div">
                <input type="checkbox" class="task_checkbox" id="checkbox-{{loop.index}}" data-result-id="task_result-{{loop.index}}">
                <label for="checkbox-{{loop.index}}" id="task_description"><strong>TASK:</strong> {{ step.description | safe }}</label>
                <details id="task_result-{{loop.index}}" class="task_result">
                    <summary class="task_result_summary">Expected Result</summary>
                    {{ step.result | safe }}
                </details>
            </div>
            {% elif step.type == "image" %}
            <p align="center">
                {{ step.html | safe }}
            </p>
            {% else %}
            {{ step.html | safe }}
            {% endif %}
            {% endfor %}
        </div>
        <form>
            <button type="button" id="next_button">Next Lesson</button>
        </form>
        <a id="logout_button" href="/logout">Logout</a>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Select all checkboxes with class "task-checkbox"
            const checkboxes = document.querySelectorAll(".task_checkbox");
            const completeButton = document.getElementById("complete_button");
            const errorMessage = document.getElementById("error_message");

            function updateButtonVisibility() {
                const allChecked = Array.from(checkboxes).every(cb => cb.checked);
                completeButton.style.display = allChecked ? "block" : "none";
                errorMessage.style.display = "none"; // Hide error message if previously shown
            }

            checkboxes.forEach(function (checkbox) {
                checkbox.addEventListener("change", function () {
                    const detailsId = this.getAttribute("data-result-id");
                    const detailsElement = document.getElementById(detailsId);
                    if (detailsElement) {
                        detailsElement.open = this.checked;
                    }
                    updateButtonVisibility();
                });
            });

            updateButtonVisibility(); // Initial check on page load
        });
    </script>
</body>

</html>